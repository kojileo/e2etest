# coupleplan.com E2Eテスト作成ガイド

## 📋 概要

このガイドでは、[coupleplan.com](https://coupleplan.com/) のWebアプリケーションに対するE2Eテストを作成する手順を説明します。Playwright MCP + Gemini AI自動化プラットフォームを使用します。

## 🚀 事前準備

### 1. アプリケーションの起動

```bash
# プロジェクトディレクトリに移動
cd C:\Users\kojil\Documents\Dev\github\e2etest

# 開発サーバーを起動
npm run dev
```

### 2. アクセス確認

- **フロントエンド**: http://localhost:3000 (または http://localhost:3001)
- **バックエンド**: http://localhost:5000

### 3. 対象サイトの分析

**coupleplan.com の主要機能（推定）:**
- カップル向けプランニング機能
- ユーザー登録・ログイン
- プラン作成・編集
- カレンダー機能
- 共有機能

## 📝 E2Eテスト作成手順

### Step 1: サイト調査とテスト対象の特定

#### 1.1 手動でサイトを確認

```
1. https://coupleplan.com/ にアクセス
2. 主要な機能とユーザーフローを特定
3. テストすべき要素（ボタン、フォーム、ナビゲーション等）を記録
```

#### 1.2 テスト対象の優先順位付け

**高優先度:**
- [ ] トップページの表示
- [ ] ユーザー登録フロー
- [ ] ログイン機能
- [ ] メイン機能（プラン作成等）

**中優先度:**
- [ ] ナビゲーション
- [ ] 検索機能
- [ ] プロフィール編集

**低優先度:**
- [ ] 詳細設定
- [ ] ヘルプページ
- [ ] フッターリンク

### Step 2: AIを使ったテストケース生成

#### 2.1 AIテストケース生成ページにアクセス

```
1. アプリのダッシュボードで「🤖 AIでテスト生成」をクリック
2. `/ai-generate` ページに移動
```

#### 2.2 基本情報の入力

**対象URL:**
```
https://coupleplan.com/
```

**テスト説明の例:**
```
カップル向けプランニングサイトの基本機能をテストしたい。
トップページの表示、ナビゲーション、主要機能へのアクセス可能性を確認する。
```

**要件例:**
```
- トップページが正常に表示されること
- メインナビゲーションが機能すること
- ユーザー登録ボタンが表示されること
- レスポンシブデザインが機能すること
```

#### 2.3 AIテストケース生成の実行

```
1. 「🤖 テストケースを生成」ボタンをクリック
2. AI信頼度とステップを確認
3. 生成されたテストが適切かレビュー
4. 「💾 シナリオとして保存」で保存
```

### Step 3: 手動でのテストシナリオ作成

#### 3.1 新規シナリオ作成

```
1. ダッシュボードで「📝 新規シナリオ作成」をクリック
2. `/create-scenario` ページに移動
```

#### 3.2 基本情報の設定

**シナリオ名例:**
```
coupleplan.com - トップページ基本機能テスト
```

**説明例:**
```
coupleplan.comのトップページにアクセスし、
基本的なナビゲーションと主要要素の表示を確認する。
```

**対象URL:**
```
https://coupleplan.com/
```

### Step 4: 具体的なテストステップの作成

#### 4.1 基本的なテストケース例

**シナリオ1: トップページ表示テスト**

```yaml
ステップ1:
  アクション: navigate (ページ移動)
  説明: coupleplan.comのトップページにアクセス
  
ステップ2:
  アクション: screenshot (スクリーンショット)
  説明: トップページの初期表示をキャプチャ
  
ステップ3:
  アクション: assert (アサーション)
  説明: ページタイトルが表示されているか確認
  セレクタ: h1, .title, [data-testid="page-title"]
  
ステップ4:
  アクション: assert (アサーション)
  説明: メインナビゲーションが表示されているか確認
  セレクタ: nav, .navigation, .menu
```

**シナリオ2: ユーザー登録ボタンテスト**

```yaml
ステップ1:
  アクション: navigate (ページ移動)
  説明: トップページにアクセス
  
ステップ2:
  アクション: click (クリック)
  説明: 会員登録ボタンをクリック
  セレクタ: [data-testid="signup-button"], .signup-btn, .register-btn
  
ステップ3:
  アクション: wait (待機)
  説明: ページ遷移を待機
  待機時間: 2000
  
ステップ4:
  アクション: assert (アサーション)
  説明: 登録フォームが表示されることを確認
  セレクタ: form, .signup-form, .registration-form
```

#### 4.2 高度なテストケース例

**シナリオ3: レスポンシブデザインテスト**

```yaml
ステップ1:
  アクション: navigate (ページ移動)
  説明: トップページにアクセス
  
ステップ2:
  アクション: screenshot (スクリーンショット)
  説明: デスクトップ表示をキャプチャ
  
ステップ3:
  アクション: wait (待機)
  説明: レイアウト安定化を待機
  待機時間: 1000
  
ステップ4:
  アクション: screenshot (スクリーンショット)
  説明: モバイル表示をキャプチャ
```

### Step 5: テストの実行と検証

#### 5.1 テスト実行

```
1. シナリオ一覧ページ (`/scenarios`) に移動
2. 作成したシナリオの「実行」ボタンをクリック
3. WebSocketでリアルタイム進行状況を確認
```

#### 5.2 結果の確認

```
1. `/executions` ページで実行履歴を確認
2. 詳細ページでステップごとの結果を分析
3. スクリーンショットで視覚的確認
4. エラーがあれば詳細を確認し、シナリオを修正
```

## 🔍 よくあるセレクタパターン

### coupleplan.com で使用する可能性の高いセレクタ

```css
/* 基本要素 */
h1, h2, h3                    /* ヘッダー */
.title, .heading              /* タイトル要素 */
nav, .navigation, .navbar     /* ナビゲーション */
.menu, .menu-item            /* メニュー */

/* ボタン類 */
.btn, .button                /* 汎用ボタン */
.btn-primary, .btn-secondary /* ボタンタイプ */
.signup-btn, .login-btn      /* 機能別ボタン */
[data-testid="button-name"]  /* テスト用属性 */

/* フォーム */
form, .form                  /* フォーム要素 */
input[type="email"]          /* Eメール入力 */
input[type="password"]       /* パスワード入力 */
.form-group, .field          /* フォームグループ */

/* レイアウト */
.container, .wrapper         /* コンテナ */
.header, .footer             /* ヘッダー・フッター */
.sidebar, .main-content      /* レイアウト要素 */
```

## ⚠️ 注意事項とベストプラクティス

### 1. テスト実行時の注意

```markdown
- サイトの利用規約を確認し、過度なアクセスを避ける
- テスト間隔を適切に設定（wait時間の調整）
- 本番環境への影響を最小限に抑える
- スクリーンショットで結果を必ず確認
```

### 2. セレクタの選び方

```markdown
✅ 推奨:
- data-testid属性
- 固有のクラス名
- 構造的に安定した要素

❌ 非推奨:
- 動的に変わるクラス名
- CSS装飾用のクラス
- 順序に依存するセレクタ
```

### 3. エラー対応

```markdown
1. セレクタが見つからない場合:
   - 要素の存在確認
   - 待機時間の調整
   - セレクタの修正

2. テスト実行失敗:
   - ネットワーク状況確認
   - サイトの変更確認
   - ブラウザの互換性確認
```

## 📊 テストカバレッジの目標

### 基本カバレッジ（優先度：高）

- [ ] トップページ表示（100%）
- [ ] 主要ナビゲーション（90%）
- [ ] ユーザー登録・ログイン（90%）
- [ ] 基本的なユーザーフロー（80%）

### 拡張カバレッジ（優先度：中）

- [ ] 各サブページ表示（70%）
- [ ] フォーム送信機能（80%）
- [ ] エラーハンドリング（60%）
- [ ] レスポンシブデザイン（70%）

### 詳細カバレッジ（優先度：低）

- [ ] 細かなUI要素（50%）
- [ ] 追加機能（50%）
- [ ] パフォーマンステスト（30%）

## 🚀 次のステップ

1. **基本テストの作成完了後:**
   - Gemini APIキーの設定
   - 実際のPlaywright統合
   - CI/CD パイプラインへの組み込み

2. **高度な機能の活用:**
   - 複数ブラウザでのテスト
   - パフォーマンス測定
   - 自動レポート生成

3. **保守性の向上:**
   - テストの定期実行
   - 結果の監視・アラート
   - テストケースの継続的改善

---

**作成日**: 2025年5月31日  
**対象サイト**: [coupleplan.com](https://coupleplan.com/)  
**ツール**: Playwright MCP + Gemini AI E2E自動化プラットフォーム 